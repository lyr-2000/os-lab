---
title: "中断是什么"
date: 2022-06-19T20:16:25+08:00
lastmod: 2022-05-11T20:02:48+08:00
categories: ["~/share/helloworld/docs/原理"]
tags: ["~/share/helloworld/docs/原理"]
author: "lyr"
draft: false
images: ["https://api.mtyqx.cn/api/random.php"]

---


### 内部中断

来自CPU内部，如内存读写错误，程序运行错误；按是否正常可分为软中断和异常

* 软中断

由软件主动发起的中断，不是客观的内部错误

* 异常

是在指令执行过程中由于微处理器内部操作发生异常引起的，如硬件失效或非法的系统调用，以及程序员预先设置断点等。

异常按轻重程度分为

1. Fault(故障)，如 page fault(分页异常)，这种异常最轻，可以被恢复

2. Trap(陷阱)

3. Abort(终止)

cpu保护自己，直接终止程序的运行。导致此异常通常是硬件错误，或者某些系统数据结构错误

### 外部中断

由外部设备：网卡，硬盘，打印机等发出的中断

CPU通过指令限制某些设备发出中断请求，称为屏蔽中断。从CPU要不要接收中断即能不能限制某些中断发生的角度 ，中断可分为

* 可屏蔽中断

可被CPU通过指令限制某些设备发出中断请求的中断

* 不可屏蔽中断(non-maskable interrupt，NMI)
不允许屏蔽的中断如电源掉电。

主要用于处理系统的意外或故障，如电源掉电、存储器读/写错误、扩展槽中输入/输出通道错误等。





操作系统对用户进程提供服务的接口
* 通过软中断触发中断
* INT和IRET指令用于系统调用，系统调用时，有堆栈切换和特权级的切换

系统调用简单流程
1. 当应用程序调用系统调用时，软中断触发0x80中断（要保护现场：如用户进程的值都保存到寄存器）
2. CPU收到中断信号，从中断向量表中，拿到中断服务例程，得到中断号
3. 通过中断号，从系统调用表中找到系统调用程序（用户无法访问的，内核的某个地址），然后开始执行（内核态就可以随心所欲操作了）
4. 执行完之后，再恢复现场，返回上层应用程序，用户进程接着运行







